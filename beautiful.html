<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Ring - 1Êó•Ë°åÂãï√óÈõÜ‰∏≠„Çø„Ç§„É†„Éà„É©„ÉÉ„Ç´„Éº</title>
    <style>
        /* === Âü∫Êú¨„Çπ„Çø„Ç§„É´ === */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* === „Éò„ÉÉ„ÉÄ„Éº === */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* === Êó•‰ªò„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ === */
        .date-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-btn, .today-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn {
            background: #667eea;
            color: white;
        }

        .today-btn {
            background: #4CAF50;
            color: white;
        }

        .nav-btn:hover, .today-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .date-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #current-date {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        /* === „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç∞„É™„ÉÉ„Éâ === */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* === Â∑¶„Éë„Éç„É´ === */
        .left-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .grid-header h2 {
            color: #333;
            font-size: 1.3rem;
        }

        .grid-stats {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #666;
        }

        /* === „Çø„Ç§„É†„Ç∞„É™„ÉÉ„Éâ === */
        .time-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 3px;
            margin-bottom: 25px;
        }

        .time-slot {
            aspect-ratio: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            position: relative;
            min-height: 60px;
        }

        .time-slot:hover {
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .time-label {
            font-size: 0.7rem;
            color: #666;
            font-weight: 500;
        }

        .block-content {
            font-size: 0.6rem;
            font-weight: bold;
            text-align: center;
            margin-top: 2px;
        }

        .time-slot.filled {
            color: white;
            border-color: transparent;
        }

        /* === „Ç´„ÉÜ„Ç¥„É™Âá°‰æã === */
        .category-legend h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-label {
            font-weight: 500;
            flex: 1;
        }

        .legend-weight {
            font-size: 0.9rem;
            font-weight: bold;
            color: #666;
        }

        /* === Âè≥„Éë„Éç„É´ === */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .summary-card, .suggestions-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .summary-card h3, .suggestions-card h3 {
            margin-bottom: 15px;
            color: #333;
        }

        /* === „Çµ„Éû„É™„Ç∞„É™„ÉÉ„Éâ === */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* === „É¢„Éº„ÉÄ„É´ === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* === „Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥ === */
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .category-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* === „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± === */
        .debug {
            background: #ffffcc;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #ffcc00;
            border-radius: 5px;
            font-size: 12px;
        }

        /* === „É¨„Çπ„Éù„É≥„Ç∑„Éñ === */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .time-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="container">
            <h1 class="logo">üéØ Focus Ring</h1>
            <p class="tagline">1Êó•Ë°åÂãï√óÈõÜ‰∏≠„Çø„Ç§„É†„Éà„É©„ÉÉ„Ç´„Éº</p>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main">
        <div class="container">
            <!-- „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± -->
            <div class="debug" id="debug-info">
                <strong>üîç „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±:</strong><br>
                <div id="debug-log">„Ç¢„Éó„É™„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>

            <!-- Êó•‰ªò„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
            <div class="date-nav">
                <button id="prev-day" class="nav-btn">‚Üê ÂâçÊó•</button>
                <div class="date-display">
                    <span id="current-date">2024-01-01</span>
                    <button id="today-btn" class="today-btn">‰ªäÊó•</button>
                </div>
                <button id="next-day" class="nav-btn">ÁøåÊó• ‚Üí</button>
            </div>

            <!-- 2„Ç´„É©„É†„É¨„Ç§„Ç¢„Ç¶„Éà -->
            <div class="content-grid">
                <!-- Â∑¶ÂÅ¥Ôºö„Çø„Ç§„É†„Ç∞„É™„ÉÉ„Éâ -->
                <div class="left-panel">
                    <div class="grid-header">
                        <h2>üìÖ „Çø„Ç§„É†„Ç∞„É™„ÉÉ„Éâ (04:00-23:45)</h2>
                        <div class="grid-stats">
                            <span id="filled-count">0</span>/80 „Éñ„É≠„ÉÉ„ÇØÂÖ•ÂäõÊ∏à„Åø
                        </div>
                    </div>

                    <!-- 80„Éû„Çπ„Ç∞„É™„ÉÉ„Éâ -->
                    <div class="time-grid" id="time-grid"></div>

                    <!-- „Ç´„ÉÜ„Ç¥„É™Âá°‰æã -->
                    <div class="category-legend">
                        <h3>üìã „Ç´„ÉÜ„Ç¥„É™Âá°‰æã</h3>
                        <div class="legend-grid" id="category-legend"></div>
                    </div>
                </div>

                <!-- Âè≥ÂÅ¥Ôºö„Çµ„Éû„É™„Éë„Éç„É´ -->
                <div class="right-panel">
                    <!-- ‰ªäÊó•„ÅÆ„Çµ„Éû„É™ -->
                    <div class="summary-card">
                        <h3>üìä ‰ªäÊó•„ÅÆ„Çµ„Éû„É™</h3>
                        <div class="summary-grid">
                            <div class="metric">
                                <div class="metric-value" id="focus-score">0.0</div>
                                <div class="metric-label">„Éï„Ç©„Éº„Ç´„Çπ„Çπ„Ç≥„Ç¢</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="productive-hours">0.0h</div>
                                <div class="metric-label">ÁîüÁî£ÁöÑÊôÇÈñì</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="deep-streak">0ÂàÜ</div>
                                <div class="metric-label">ÊúÄÂ§ßÈÄ£Á∂öÈõÜ‰∏≠</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="distract-ratio">0%</div>
                                <div class="metric-label">Â¶®ÂÆ≥ÊôÇÈñìÂâ≤Âêà</div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊîπÂñÑÊèêÊ°à -->
                    <div class="suggestions-card">
                        <h3>üí° ÊîπÂñÑÊèêÊ°à</h3>
                        <div class="suggestions-content">
                            <div class="summary-text" id="suggestion-summary">
                                „Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åô„Çã„Å®ÊîπÂñÑÊèêÊ°à„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚è∞ <span id="modal-time">04:00</span> „ÅÆ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû</h3>
                <button class="modal-close" id="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <div class="all-categories">
                    <h4>üìÇ „Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß</h4>
                    <div class="category-buttons" id="all-categories"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === „Ç´„ÉÜ„Ç¥„É™ÂÆöÁæ© ===
        const CATEGORIES = [
            { code: "STUDY", label: "üìö ÂãâÂº∑", weight: 3, color: "#4CAF50", order_index: 0 },
            { code: "ENGLISH", label: "üåç Ëã±Ë™û", weight: 4, color: "#2196F3", order_index: 1 },
            { code: "AI_LEARNING", label: "ü§ñ AIÂ≠¶Áøí", weight: 4, color: "#9C27B0", order_index: 2 },
            { code: "WORK_LOG", label: "üíº ‰ΩúÊ•≠„É≠„Ç∞", weight: 4, color: "#FF9800", order_index: 3 },
            { code: "BLOG", label: "‚úçÔ∏è „Éñ„É≠„Ç∞", weight: 3, color: "#795548", order_index: 4 },
            { code: "WALK", label: "üêï Êï£Ê≠©", weight: 2, color: "#8BC34A", order_index: 5 },
            { code: "FARMING", label: "üå± Ëæ≤‰ΩúÊ•≠", weight: 2, color: "#4CAF50", order_index: 6 },
            { code: "HOUSEWORK", label: "üè† ÂÆ∂‰∫ã", weight: 1, color: "#607D8B", order_index: 7 },
            { code: "MANAGEMENT", label: "üìã ÁÆ°ÁêÜ", weight: 1, color: "#9E9E9E", order_index: 8 },
            { code: "HEALTH", label: "üí™ ÂÅ•Â∫∑", weight: 2, color: "#F44336", order_index: 9 },
            { code: "MEAL", label: "üçΩÔ∏è È£ü‰∫ã", weight: 0, color: "#FFC107", order_index: 10 },
            { code: "REST", label: "üò¥ ‰ºëÊÜ©", weight: 0, color: "#CDDC39", order_index: 11 },
            { code: "SLEEP", label: "üõèÔ∏è Áù°Áú†", weight: 0, color: "#3F51B5", order_index: 12 },
            { code: "VIDEO", label: "üì∫ ÂãïÁîª", weight: -2, color: "#E91E63", order_index: 13 },
            { code: "SNS", label: "üì± SNS", weight: -3, color: "#FF5722", order_index: 14 },
            { code: "WASTE", label: "‚ùì ÁÑ°ÈßÑÊôÇÈñì", weight: -4, color: "#424242", order_index: 15 }
        ];

        // === „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ ===
        let currentDate = new Date().toISOString().split('T')[0];
        let currentSlotIndex = null;
        let slotData = {}; // „Ç∑„É≥„Éó„É´„Å™„Éá„Éº„Çø‰øùÂ≠òÔºà„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆ‰ª£„Çè„ÇäÔºâ

        // === „Éá„Éê„ÉÉ„Ç∞Èñ¢Êï∞ ===
        function debug(message) {
            console.log('üîç BEAUTIFUL DEBUG:', message);
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<br>${timestamp}: ${message}`;
        }

        // === „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞ ===
        function formatTime(slotIndex) {
            const startHour = 4;
            const totalMinutes = startHour * 60 + slotIndex * 15;
            const hours = Math.floor(totalMinutes / 60) % 24;
            const minutes = totalMinutes % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        function getStorageKey(date, slotIndex) {
            return `${date}_${slotIndex}`;
        }

        function getBlockData(date, slotIndex) {
            const key = getStorageKey(date, slotIndex);
            return slotData[key] || { category: null };
        }

        function saveBlockData(date, slotIndex, data) {
            const key = getStorageKey(date, slotIndex);
            slotData[key] = data;
            debug(`„Éá„Éº„Çø‰øùÂ≠ò: ${key} = ${JSON.stringify(data)}`);
        }

        function getCategoryByCode(code) {
            return CATEGORIES.find(cat => cat.code === code);
        }

        // === UIÁîüÊàêÈñ¢Êï∞ ===
        function generateTimeGrid() {
            debug('80„Éû„Çπ„Ç∞„É™„ÉÉ„ÉâÁîüÊàêÈñãÂßã');
            const gridContainer = document.getElementById('time-grid');
            gridContainer.innerHTML = '';

            for (let i = 0; i < 80; i++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.dataset.slotIndex = i;
                timeSlot.id = `slot-${i}`;
                
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                timeLabel.textContent = formatTime(i);
                
                const blockContent = document.createElement('div');
                blockContent.className = 'block-content';
                blockContent.id = `content-${i}`;
                
                timeSlot.appendChild(timeLabel);
                timeSlot.appendChild(blockContent);
                
                // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                timeSlot.addEventListener('click', () => openCategoryModal(i));
                
                gridContainer.appendChild(timeSlot);
            }
            debug('80„Éû„Çπ„Ç∞„É™„ÉÉ„ÉâÁîüÊàêÂÆå‰∫Ü');
        }

        function generateCategoryLegend() {
            debug('„Ç´„ÉÜ„Ç¥„É™Âá°‰æãÁîüÊàêÈñãÂßã');
            const legendContainer = document.getElementById('category-legend');
            legendContainer.innerHTML = '';

            CATEGORIES.forEach(category => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorDiv = document.createElement('div');
                colorDiv.className = 'legend-color';
                colorDiv.style.backgroundColor = category.color;
                
                const labelSpan = document.createElement('span');
                labelSpan.className = 'legend-label';
                labelSpan.textContent = category.label;
                
                const weightSpan = document.createElement('span');
                weightSpan.className = 'legend-weight';
                weightSpan.textContent = `(${category.weight > 0 ? '+' : ''}${category.weight})`;
                
                legendItem.appendChild(colorDiv);
                legendItem.appendChild(labelSpan);
                legendItem.appendChild(weightSpan);
                legendContainer.appendChild(legendItem);
            });
            debug('„Ç´„ÉÜ„Ç¥„É™Âá°‰æãÁîüÊàêÂÆå‰∫Ü');
        }

        function updateTimeGrid() {
            debug('„Ç∞„É™„ÉÉ„ÉâË°®Á§∫Êõ¥Êñ∞ÈñãÂßã');
            let filledCount = 0;

            for (let i = 0; i < 80; i++) {
                const blockData = getBlockData(currentDate, i);
                const slot = document.getElementById(`slot-${i}`);
                const content = document.getElementById(`content-${i}`);
                
                if (blockData.category) {
                    filledCount++;
                    const category = getCategoryByCode(blockData.category);
                    if (category && slot && content) {
                        slot.style.backgroundColor = category.color;
                        content.textContent = category.label;
                        slot.classList.add('filled');
                        debug(`„Çπ„É≠„ÉÉ„Éà${i}Êõ¥Êñ∞: ${category.label}`);
                    }
                } else {
                    if (slot && content) {
                        slot.style.backgroundColor = '';
                        content.textContent = '';
                        slot.classList.remove('filled');
                    }
                }
            }

            document.getElementById('filled-count').textContent = filledCount;
            debug(`„Ç∞„É™„ÉÉ„ÉâË°®Á§∫Êõ¥Êñ∞ÂÆå‰∫Ü: ${filledCount}/80 ÂÖ•ÂäõÊ∏à„Åø`);
        }

        function updateSummary() {
            debug('„Çµ„Éû„É™Êõ¥Êñ∞ÈñãÂßã');
            let productiveBlocks = 0;
            let distractBlocks = 0;
            let focusScore = 0;

            for (let i = 0; i < 80; i++) {
                const blockData = getBlockData(currentDate, i);
                if (blockData.category) {
                    const category = getCategoryByCode(blockData.category);
                    if (category) {
                        if (category.weight > 0) productiveBlocks++;
                        if (category.weight < 0) distractBlocks++;
                        focusScore += category.weight;
                    }
                }
            }

            const totalFilled = productiveBlocks + distractBlocks;
            const productiveHours = productiveBlocks * 0.25;
            const distractRatio = totalFilled > 0 ? (distractBlocks / totalFilled) : 0;
            const deepStreak = Math.max(1, Math.ceil(productiveBlocks / 4));

            document.getElementById('focus-score').textContent = focusScore.toFixed(1);
            document.getElementById('productive-hours').textContent = productiveHours.toFixed(1) + 'h';
            document.getElementById('deep-streak').textContent = (deepStreak * 15) + 'ÂàÜ';
            document.getElementById('distract-ratio').textContent = (distractRatio * 100).toFixed(0) + '%';
            
            debug('„Çµ„Éû„É™Êõ¥Êñ∞ÂÆå‰∫Ü');
        }

        // === „É¢„Éº„ÉÄ„É´Ê©üËÉΩ ===
        function openCategoryModal(slotIndex) {
            debug(`„É¢„Éº„ÉÄ„É´Èñã„Åè: „Çπ„É≠„ÉÉ„Éà${slotIndex} (${formatTime(slotIndex)})`);
            currentSlotIndex = slotIndex;
            const modal = document.getElementById('category-modal');
            const timeLabel = document.getElementById('modal-time');
            
            timeLabel.textContent = formatTime(slotIndex);
            
            // „Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥ÁîüÊàê
            const allCategoriesContainer = document.getElementById('all-categories');
            allCategoriesContainer.innerHTML = '';
            
            CATEGORIES.forEach((category, index) => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.style.backgroundColor = category.color;
                button.textContent = category.label;
                button.addEventListener('click', () => {
                    debug(`„Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ: ${category.label} (${category.code})`);
                    selectCategory(category.code);
                });
                allCategoriesContainer.appendChild(button);
                debug(`„Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥${index + 1}‰ΩúÊàê: ${category.label}`);
            });
            
            modal.classList.add('active');
            debug('„É¢„Éº„ÉÄ„É´Ë°®Á§∫ÂÆå‰∫Ü');
        }

        function selectCategory(categoryCode) {
            debug(`„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÈñãÂßã: ${categoryCode} for slot ${currentSlotIndex}`);
            
            if (currentSlotIndex !== null) {
                saveBlockData(currentDate, currentSlotIndex, { category: categoryCode });
                updateTimeGrid();
                updateSummary();
                closeCategoryModal();
                debug('‚úÖ „Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÂÆå‰∫Ü');
            } else {
                debug('‚ùå „Ç®„É©„Éº: currentSlotIndex „Åå null');
            }
        }

        function closeCategoryModal() {
            debug('„É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã');
            document.getElementById('category-modal').classList.remove('active');
            currentSlotIndex = null;
        }

        function updateCurrentDate() {
            document.getElementById('current-date').textContent = currentDate;
        }

        // === „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº ===
        function initializeEventHandlers() {
            debug('„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºË®≠ÂÆöÈñãÂßã');
            
            // Êó•‰ªò„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
            document.getElementById('prev-day').addEventListener('click', () => {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - 1);
                currentDate = date.toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            document.getElementById('next-day').addEventListener('click', () => {
                const date = new Date(currentDate);
                date.setDate(date.getDate() + 1);
                currentDate = date.toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            document.getElementById('today-btn').addEventListener('click', () => {
                currentDate = new Date().toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            // „É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã
            document.getElementById('modal-close').addEventListener('click', closeCategoryModal);
            
            // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            document.getElementById('category-modal').addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeCategoryModal();
                }
            });
            
            // ESC„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeCategoryModal();
                }
            });
            
            debug('„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºË®≠ÂÆöÂÆå‰∫Ü');
        }

        // === ÂàùÊúüÂåñ ===
        function initializeApp() {
            debug('üéØ Beautiful Focus Ring ÂàùÊúüÂåñÈñãÂßã');
            
            // UIÁîüÊàê
            generateTimeGrid();
            generateCategoryLegend();
            
            // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºË®≠ÂÆö
            initializeEventHandlers();
            
            // ÂàùÊúü„Éá„Éº„ÇøË°®Á§∫
            updateCurrentDate();
            updateTimeGrid();
            updateSummary();
            
            debug('‚úÖ Beautiful Focus Ring ÂàùÊúüÂåñÂÆå‰∫Ü - „ÉÜ„Çπ„ÉàÊ∫ñÂÇôOK!');
        }

        // === „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ëµ∑Âãï ===
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>