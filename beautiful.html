<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Ring - 1æ—¥è¡Œå‹•Ã—é›†ä¸­ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
    <style>
        /* === åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« === */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* === æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ === */
        .date-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-btn, .today-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn {
            background: #667eea;
            color: white;
        }

        .today-btn {
            background: #4CAF50;
            color: white;
        }

        .nav-btn:hover, .today-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .date-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #current-date {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        /* === ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚°ãƒªãƒƒãƒ‰ === */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* === å·¦ãƒ‘ãƒãƒ« === */
        .left-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .grid-header h2 {
            color: #333;
            font-size: 1.3rem;
        }

        .grid-stats {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #666;
        }

        /* === ã‚¿ã‚¤ãƒ ã‚°ãƒªãƒƒãƒ‰ === */
        .time-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 3px;
            margin-bottom: 25px;
        }

        .time-slot {
            aspect-ratio: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            position: relative;
            min-height: 60px;
        }

        .time-slot:hover {
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .time-label {
            font-size: 0.7rem;
            color: #666;
            font-weight: 500;
        }

        .block-content {
            font-size: 0.6rem;
            font-weight: bold;
            text-align: center;
            margin-top: 2px;
        }

        .time-slot.filled {
            color: white;
            border-color: transparent;
        }

        /* === ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹ === */
        .category-legend h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-label {
            font-weight: 500;
            flex: 1;
        }

        .legend-weight {
            font-size: 0.9rem;
            font-weight: bold;
            color: #666;
        }

        /* === å³ãƒ‘ãƒãƒ« === */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .summary-card, .suggestions-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .summary-card h3, .suggestions-card h3 {
            margin-bottom: 15px;
            color: #333;
        }

        /* === ã‚µãƒãƒªã‚°ãƒªãƒƒãƒ‰ === */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* === ãƒ¢ãƒ¼ãƒ€ãƒ« === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* === ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ === */
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .category-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* === ãƒ‡ãƒãƒƒã‚°æƒ…å ± === */
        .debug {
            background: #ffffcc;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #ffcc00;
            border-radius: 5px;
            font-size: 12px;
        }

        /* === ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– === */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .time-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <h1 class="logo">ğŸ¯ Focus Ring</h1>
            <p class="tagline">1æ—¥è¡Œå‹•Ã—é›†ä¸­ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚«ãƒ¼</p>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main">
        <div class="container">
            <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
            <div class="debug" id="debug-info">
                <strong>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong><br>
                <div id="debug-log">ã‚¢ãƒ—ãƒªã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>

            <!-- æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="date-nav">
                <button id="prev-day" class="nav-btn">â† å‰æ—¥</button>
                <div class="date-display">
                    <span id="current-date">2024-01-01</span>
                    <button id="today-btn" class="today-btn">ä»Šæ—¥</button>
                </div>
                <button id="next-day" class="nav-btn">ç¿Œæ—¥ â†’</button>
            </div>

            <!-- 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
            <div class="content-grid">
                <!-- å·¦å´ï¼šã‚¿ã‚¤ãƒ ã‚°ãƒªãƒƒãƒ‰ -->
                <div class="left-panel">
                    <div class="grid-header">
                        <h2>ğŸ“… ã‚¿ã‚¤ãƒ ã‚°ãƒªãƒƒãƒ‰ (04:00-23:45)</h2>
                        <div class="grid-stats">
                            <span id="filled-count">0</span>/80 ãƒ–ãƒ­ãƒƒã‚¯å…¥åŠ›æ¸ˆã¿
                        </div>
                    </div>

                    <!-- 80ãƒã‚¹ã‚°ãƒªãƒƒãƒ‰ -->
                    <div class="time-grid" id="time-grid"></div>

                    <!-- ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹ -->
                    <div class="category-legend">
                        <h3>ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹</h3>
                        <div class="legend-grid" id="category-legend"></div>
                    </div>
                </div>

                <!-- å³å´ï¼šã‚µãƒãƒªãƒ‘ãƒãƒ« -->
                <div class="right-panel">
                    <!-- ä»Šæ—¥ã®ã‚µãƒãƒª -->
                    <div class="summary-card">
                        <h3>ğŸ“Š ä»Šæ—¥ã®ã‚µãƒãƒª</h3>
                        <div class="summary-grid">
                            <div class="metric">
                                <div class="metric-value" id="focus-score">0.0</div>
                                <div class="metric-label">ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚³ã‚¢</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="productive-hours">0.0h</div>
                                <div class="metric-label">ç”Ÿç”£çš„æ™‚é–“</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="deep-streak">0åˆ†</div>
                                <div class="metric-label">æœ€å¤§é€£ç¶šé›†ä¸­</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="distract-ratio">0%</div>
                                <div class="metric-label">å¦¨å®³æ™‚é–“å‰²åˆ</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ”¹å–„ææ¡ˆ -->
                    <div class="suggestions-card">
                        <h3>ğŸ’¡ æ”¹å–„ææ¡ˆ</h3>
                        <div class="suggestions-content">
                            <div class="summary-text" id="suggestion-summary">
                                ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨æ”¹å–„ææ¡ˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â° <span id="modal-time">04:00</span> ã®ã‚«ãƒ†ã‚´ãƒªé¸æŠ</h3>
                <button class="modal-close" id="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="all-categories">
                    <h4>ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªä¸€è¦§</h4>
                    <div class="category-buttons" id="all-categories"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === ã‚«ãƒ†ã‚´ãƒªå®šç¾© ===
        const CATEGORIES = [
            { code: "STUDY", label: "ğŸ“š å‹‰å¼·", weight: 3, color: "#4CAF50", order_index: 0 },
            { code: "ENGLISH", label: "ğŸŒ è‹±èª", weight: 4, color: "#2196F3", order_index: 1 },
            { code: "AI_LEARNING", label: "ğŸ¤– AIå­¦ç¿’", weight: 4, color: "#9C27B0", order_index: 2 },
            { code: "WORK_LOG", label: "ğŸ’¼ ä½œæ¥­ãƒ­ã‚°", weight: 4, color: "#FF9800", order_index: 3 },
            { code: "BLOG", label: "âœï¸ ãƒ–ãƒ­ã‚°", weight: 3, color: "#795548", order_index: 4 },
            { code: "WALK", label: "ğŸ• æ•£æ­©", weight: 2, color: "#8BC34A", order_index: 5 },
            { code: "FARMING", label: "ğŸŒ± è¾²ä½œæ¥­", weight: 2, color: "#4CAF50", order_index: 6 },
            { code: "HOUSEWORK", label: "ğŸ  å®¶äº‹", weight: 1, color: "#607D8B", order_index: 7 },
            { code: "MANAGEMENT", label: "ğŸ“‹ ç®¡ç†", weight: 1, color: "#9E9E9E", order_index: 8 },
            { code: "HEALTH", label: "ğŸ’ª å¥åº·", weight: 2, color: "#F44336", order_index: 9 },
            { code: "MEAL", label: "ğŸ½ï¸ é£Ÿäº‹", weight: 0, color: "#FFC107", order_index: 10 },
            { code: "REST", label: "ğŸ˜´ ä¼‘æ†©", weight: 0, color: "#CDDC39", order_index: 11 },
            { code: "SLEEP", label: "ğŸ›ï¸ ç¡çœ ", weight: 0, color: "#3F51B5", order_index: 12 },
            { code: "VIDEO", label: "ğŸ“º å‹•ç”»", weight: -2, color: "#E91E63", order_index: 13 },
            { code: "SNS", label: "ğŸ“± SNS", weight: -3, color: "#FF5722", order_index: 14 },
            { code: "WASTE", label: "â“ ç„¡é§„æ™‚é–“", weight: -4, color: "#424242", order_index: 15 }
        ];

        // === ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ===
        let currentDate = new Date().toISOString().split('T')[0];
        let currentSlotIndex = null;
        let slotData = {}; // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä»£ã‚ã‚Šï¼‰

        // === ãƒ‡ãƒãƒƒã‚°é–¢æ•° ===
        function debug(message) {
            console.log('ğŸ” BEAUTIFUL DEBUG:', message);
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<br>${timestamp}: ${message}`;
        }

        // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ===
        function formatTime(slotIndex) {
            const startHour = 4;
            const totalMinutes = startHour * 60 + slotIndex * 15;
            const hours = Math.floor(totalMinutes / 60) % 24;
            const minutes = totalMinutes % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        function getStorageKey(date, slotIndex) {
            return `${date}_${slotIndex}`;
        }

        function getBlockData(date, slotIndex) {
            const key = getStorageKey(date, slotIndex);
            return slotData[key] || { category: null };
        }

        function saveBlockData(date, slotIndex, data) {
            const key = getStorageKey(date, slotIndex);
            slotData[key] = data;
            debug(`ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ${key} = ${JSON.stringify(data)}`);
        }

        function getCategoryByCode(code) {
            return CATEGORIES.find(cat => cat.code === code);
        }

        // === UIç”Ÿæˆé–¢æ•° ===
        function generateTimeGrid() {
            debug('80ãƒã‚¹ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆé–‹å§‹');
            const gridContainer = document.getElementById('time-grid');
            gridContainer.innerHTML = '';

            for (let i = 0; i < 80; i++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.dataset.slotIndex = i;
                timeSlot.id = `slot-${i}`;
                
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                timeLabel.textContent = formatTime(i);
                
                const blockContent = document.createElement('div');
                blockContent.className = 'block-content';
                blockContent.id = `content-${i}`;
                
                timeSlot.appendChild(timeLabel);
                timeSlot.appendChild(blockContent);
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                timeSlot.addEventListener('click', () => openCategoryModal(i));
                
                gridContainer.appendChild(timeSlot);
            }
            debug('80ãƒã‚¹ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆå®Œäº†');
        }

        function generateCategoryLegend() {
            debug('ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹ç”Ÿæˆé–‹å§‹');
            const legendContainer = document.getElementById('category-legend');
            legendContainer.innerHTML = '';

            CATEGORIES.forEach(category => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorDiv = document.createElement('div');
                colorDiv.className = 'legend-color';
                colorDiv.style.backgroundColor = category.color;
                
                const labelSpan = document.createElement('span');
                labelSpan.className = 'legend-label';
                labelSpan.textContent = category.label;
                
                const weightSpan = document.createElement('span');
                weightSpan.className = 'legend-weight';
                weightSpan.textContent = `(${category.weight > 0 ? '+' : ''}${category.weight})`;
                
                legendItem.appendChild(colorDiv);
                legendItem.appendChild(labelSpan);
                legendItem.appendChild(weightSpan);
                legendContainer.appendChild(legendItem);
            });
            debug('ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹ç”Ÿæˆå®Œäº†');
        }

        function updateTimeGrid() {
            debug('ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºæ›´æ–°é–‹å§‹');
            let filledCount = 0;

            for (let i = 0; i < 80; i++) {
                const blockData = getBlockData(currentDate, i);
                const slot = document.getElementById(`slot-${i}`);
                const content = document.getElementById(`content-${i}`);
                
                if (blockData.category) {
                    filledCount++;
                    const category = getCategoryByCode(blockData.category);
                    if (category && slot && content) {
                        slot.style.backgroundColor = category.color;
                        content.textContent = category.label;
                        slot.classList.add('filled');
                        debug(`ã‚¹ãƒ­ãƒƒãƒˆ${i}æ›´æ–°: ${category.label}`);
                    }
                } else {
                    if (slot && content) {
                        slot.style.backgroundColor = '';
                        content.textContent = '';
                        slot.classList.remove('filled');
                    }
                }
            }

            document.getElementById('filled-count').textContent = filledCount;
            debug(`ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºæ›´æ–°å®Œäº†: ${filledCount}/80 å…¥åŠ›æ¸ˆã¿`);
        }

        function updateSummary() {
            debug('ã‚µãƒãƒªæ›´æ–°é–‹å§‹');
            let productiveBlocks = 0;
            let distractBlocks = 0;
            let focusScore = 0;

            for (let i = 0; i < 80; i++) {
                const blockData = getBlockData(currentDate, i);
                if (blockData.category) {
                    const category = getCategoryByCode(blockData.category);
                    if (category) {
                        if (category.weight > 0) productiveBlocks++;
                        if (category.weight < 0) distractBlocks++;
                        focusScore += category.weight;
                    }
                }
            }

            const totalFilled = productiveBlocks + distractBlocks;
            const productiveHours = productiveBlocks * 0.25;
            const distractRatio = totalFilled > 0 ? (distractBlocks / totalFilled) : 0;
            const deepStreak = Math.max(1, Math.ceil(productiveBlocks / 4));

            document.getElementById('focus-score').textContent = focusScore.toFixed(1);
            document.getElementById('productive-hours').textContent = productiveHours.toFixed(1) + 'h';
            document.getElementById('deep-streak').textContent = (deepStreak * 15) + 'åˆ†';
            document.getElementById('distract-ratio').textContent = (distractRatio * 100).toFixed(0) + '%';
            
            debug('ã‚µãƒãƒªæ›´æ–°å®Œäº†');
        }

        // === ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½ ===
        function openCategoryModal(slotIndex) {
            debug(`ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹ã: ã‚¹ãƒ­ãƒƒãƒˆ${slotIndex} (${formatTime(slotIndex)})`);
            currentSlotIndex = slotIndex;
            const modal = document.getElementById('category-modal');
            const timeLabel = document.getElementById('modal-time');
            
            timeLabel.textContent = formatTime(slotIndex);
            
            // ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ç”Ÿæˆ
            const allCategoriesContainer = document.getElementById('all-categories');
            allCategoriesContainer.innerHTML = '';
            
            CATEGORIES.forEach((category, index) => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.style.backgroundColor = category.color;
                button.textContent = category.label;
                button.addEventListener('click', () => {
                    debug(`ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯: ${category.label} (${category.code})`);
                    selectCategory(category.code);
                });
                allCategoriesContainer.appendChild(button);
                debug(`ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³${index + 1}ä½œæˆ: ${category.label}`);
            });
            
            modal.classList.add('active');
            debug('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºå®Œäº†');
        }

        function selectCategory(categoryCode) {
            debug(`ã‚«ãƒ†ã‚´ãƒªé¸æŠé–‹å§‹: ${categoryCode} for slot ${currentSlotIndex}`);
            
            if (currentSlotIndex !== null) {
                saveBlockData(currentDate, currentSlotIndex, { category: categoryCode });
                updateTimeGrid();
                updateSummary();
                closeCategoryModal();
                debug('âœ… ã‚«ãƒ†ã‚´ãƒªé¸æŠå®Œäº†');
            } else {
                debug('âŒ ã‚¨ãƒ©ãƒ¼: currentSlotIndex ãŒ null');
            }
        }

        function closeCategoryModal() {
            debug('ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹');
            document.getElementById('category-modal').classList.remove('active');
            currentSlotIndex = null;
        }

        function updateCurrentDate() {
            document.getElementById('current-date').textContent = currentDate;
        }

        // === ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ===
        function initializeEventHandlers() {
            debug('ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®šé–‹å§‹');
            
            // æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            document.getElementById('prev-day').addEventListener('click', () => {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - 1);
                currentDate = date.toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            document.getElementById('next-day').addEventListener('click', () => {
                const date = new Date(currentDate);
                date.setDate(date.getDate() + 1);
                currentDate = date.toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            document.getElementById('today-btn').addEventListener('click', () => {
                currentDate = new Date().toISOString().split('T')[0];
                updateCurrentDate();
                updateTimeGrid();
                updateSummary();
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
            document.getElementById('modal-close').addEventListener('click', closeCategoryModal);
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.getElementById('category-modal').addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeCategoryModal();
                }
            });
            
            // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeCategoryModal();
                }
            });
            
            debug('ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®šå®Œäº†');
        }

        // === åˆæœŸåŒ– ===
        function initializeApp() {
            debug('ğŸ¯ Beautiful Focus Ring åˆæœŸåŒ–é–‹å§‹');
            
            // UIç”Ÿæˆ
            generateTimeGrid();
            generateCategoryLegend();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
            initializeEventHandlers();
            
            // åˆæœŸãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
            updateCurrentDate();
            updateTimeGrid();
            updateSummary();
            
            debug('âœ… Beautiful Focus Ring åˆæœŸåŒ–å®Œäº† - ãƒ†ã‚¹ãƒˆæº–å‚™OK!');
        }

        // === ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹• ===
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>