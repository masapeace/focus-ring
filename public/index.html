<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Ring - Test Version</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .time-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 2px; margin: 20px 0; }
        .time-slot { border: 1px solid #ccc; padding: 5px; min-height: 40px; cursor: pointer; }
        .time-slot:hover { background-color: #f0f0f0; }
        .filled { font-weight: bold; }
        .legend-item { display: inline-block; margin: 5px; padding: 3px 6px; border-radius: 3px; color: white; }
        .summary { background: #f5f5f5; padding: 15px; margin: 20px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ¯ Focus Ring - Test Version</h1>
    
    <div>
        <button id="prev-day">â†</button>
        <span id="current-date">2025-01-01</span>
        <button id="next-day">â†’</button>
        <button id="today-btn">ä»Šæ—¥</button>
    </div>

    <h2>ğŸ“… ã‚¿ã‚¤ãƒ ã‚°ãƒªãƒƒãƒ‰ (04:00-23:45)</h2>
    <div><span id="filled-count">0</span>/80 ãƒ–ãƒ­ãƒƒã‚¯å…¥åŠ›æ¸ˆã¿</div>
    <div class="time-grid" id="time-grid"></div>

    <h2>ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªå‡¡ä¾‹</h2>
    <div id="category-legend"></div>

    <div class="summary">
        <h3>ğŸ“Š ä»Šæ—¥ã®ã‚µãƒãƒª</h3>
        <div>ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚³ã‚¢: <span id="focus-score">0.0</span></div>
        <div>ç”Ÿç”£çš„æ™‚é–“: <span id="productive-hours">0.0h</span></div>
        <div>æœ€å¤§é€£ç¶šé›†ä¸­: <span id="deep-streak">0åˆ†</span></div>
        <div>å¦¨å®³æ™‚é–“å‰²åˆ: <span id="distract-ratio">0%</span></div>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç°¡æ˜“ç‰ˆï¼‰ -->
    <div id="category-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #ccc; padding: 20px; z-index: 1000;">
        <h3>â° <span id="modal-time">04:00</span> ã®ã‚«ãƒ†ã‚´ãƒªé¸æŠ</h3>
        <button onclick="closeCategoryModal()">Ã—</button>
        <div id="all-categories"></div>
    </div>

    <!-- è©³ç´°ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç°¡æ˜“ç‰ˆï¼‰ -->
    <div id="detail-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #ccc; padding: 20px; z-index: 1000;">
        <h3>ğŸ“ <span id="detail-time">04:00</span> ã®è©³ç´°ç·¨é›†</h3>
        <button onclick="closeDetailModal()">Ã—</button>
        <div>
            <label>ã‚«ãƒ†ã‚´ãƒª:</label>
            <select id="detail-category">
                <option value="">æœªé¸æŠ</option>
            </select>
        </div>
        <div>
            <label>ãƒ¡ãƒ¢:</label>
            <textarea id="detail-memo" rows="3"></textarea>
        </div>
        <button id="detail-save">ğŸ’¾ ä¿å­˜</button>
    </div>

    <script>
        // ç°¡æ˜“ç‰ˆã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥åŸ‹ã‚è¾¼ã¿
        const CATEGORIES = [
            { code: "STUDY", label: "ğŸ“š å‹‰å¼·", weight: 3, color: "#4CAF50" },
            { code: "ENGLISH", label: "ğŸŒ è‹±èª", weight: 4, color: "#2196F3" },
            { code: "WORK_LOG", label: "ğŸ’¼ ä½œæ¥­ãƒ­ã‚°", weight: 4, color: "#FF9800" },
            { code: "VIDEO", label: "ğŸ“º å‹•ç”»", weight: -2, color: "#E91E63" },
            { code: "SNS", label: "ğŸ“± SNS", weight: -3, color: "#FF5722" }
        ];

        let currentDate = new Date().toISOString().split('T')[0];
        let selectedSlot = null;

        function formatTime(slotIndex) {
            const totalMinutes = 4 * 60 + slotIndex * 15;
            const hours = Math.floor(totalMinutes / 60) % 24;
            const minutes = totalMinutes % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        function generateTimeGrid() {
            const grid = document.getElementById('time-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 80; i++) {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = formatTime(i);
                slot.onclick = () => openCategoryModal(i);
                grid.appendChild(slot);
            }
        }

        function generateCategoryLegend() {
            const legend = document.getElementById('category-legend');
            legend.innerHTML = '';
            
            CATEGORIES.forEach(cat => {
                const item = document.createElement('span');
                item.className = 'legend-item';
                item.style.backgroundColor = cat.color;
                item.textContent = cat.label + ' (' + (cat.weight > 0 ? '+' : '') + cat.weight + ')';
                legend.appendChild(item);
            });
        }

        function openCategoryModal(slotIndex) {
            selectedSlot = slotIndex;
            document.getElementById('modal-time').textContent = formatTime(slotIndex);
            
            const container = document.getElementById('all-categories');
            container.innerHTML = '';
            
            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                btn.textContent = cat.label;
                btn.style.backgroundColor = cat.color;
                btn.style.color = 'white';
                btn.style.margin = '5px';
                btn.onclick = () => selectCategory(cat.code);
                container.appendChild(btn);
            });
            
            document.getElementById('category-modal').style.display = 'block';
        }

        function selectCategory(code) {
            if (selectedSlot !== null) {
                // é¸æŠã•ã‚ŒãŸãƒã‚¹ã‚’å–å¾—
                const slots = document.querySelectorAll('.time-slot');
                const selectedSlotElement = slots[selectedSlot];
                
                // ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ã‚’å–å¾—
                const category = CATEGORIES.find(cat => cat.code === code);
                
                if (category && selectedSlotElement) {
                    // ãƒã‚¹ã«è‰²ã¨æ–‡å­—ã‚’è¨­å®š
                    selectedSlotElement.style.backgroundColor = category.color;
                    selectedSlotElement.style.color = 'white';
                    selectedSlotElement.textContent = `${formatTime(selectedSlot)} ${category.label}`;
                    selectedSlotElement.classList.add('filled');
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    const key = `focus_ring_${currentDate}_${selectedSlot}`;
                    localStorage.setItem(key, JSON.stringify({
                        category: code,
                        updated_at: new Date().toISOString()
                    }));
                    
                    // å…¥åŠ›æ¸ˆã¿ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
                    updateFilledCount();
                }
            }
            closeCategoryModal();
        }
        
        function updateFilledCount() {
            const filledSlots = document.querySelectorAll('.time-slot.filled');
            document.getElementById('filled-count').textContent = filledSlots.length;
        }

        window.closeCategoryModal = function() {
            document.getElementById('category-modal').style.display = 'none';
        }

        window.closeDetailModal = function() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ Focus Ring Test Version Loading...');
            
            document.getElementById('current-date').textContent = currentDate;
            generateTimeGrid();
            generateCategoryLegend();
            
            console.log('âœ… Focus Ring Test Version Ready!');
        });
    </script>
</body>
</html>